{% extends "/base.html" %}
{% set active_page = "projects" %}
{% set active_project = project.short_name %}
{% import "projects/_helpers.html" as helper %}

{% block content %}
{% from "_formhelpers.html" import render_field %}
{{ helper.render_loading(loading_text) }}
<style type="text/css">
.selected {
    background-color: #D4D4D4;
}
</style>
<div class="row">
    <div class="span3">
        {{ helper.render_project_local_nav(project, 'tasks', current_user, pro_features)}}
    </div>

    <div class="span9">
        <h1><strong>{{project.name}}</strong>: {{_('Import tasks')}}</h1>
        <h2>{{_('From Youtube')}}</h2>
        <br>
        <span class="help-inline"> {{ _('Please provide a URL to a Youtube playlist with videos for') }} {{ active_project }}.
        </span>
        <br>
        <div id="objects-container" class="row">
            <ul id="objects"></ul>
        </div>
        {% if form %}
        <form class="form-group" method="post" action="{{ url_for(target, short_name=project.short_name) }}">
            <fieldset>
                {{ form.hidden_tag() }}
                {{ render_field(form.playlist_url, class="input-block-level", placeholder=_("URL of a Youtube Playlist")) }}
            </fieldset>
            <input id="submit" type="submit" value="{{_('Import')}}" class="btn btn-primary" />
            <a href="{{ url_for('project.tasks', short_name=project.short_name) }}" class="btn">{{_('Cancel')}}</a>
        </form>
        {% endif %}
    </div>
</div>
<script>

    var input_counter = 0;

    // var videos = []

    // Use the API Loader script to load google.picker and gapi.auth.
    function newPicker() {
      gapi.load('picker', {'callback': createPicker});
    }

    // Create and render a Picker object for picking user Photos.
    function createPicker() {
        var videoView = new google.picker.VideoSearchView()
            .setSite(google.picker.VideoSearchView.YOUTUBE);
        var picker = new google.picker.PickerBuilder().
            addView(videoView).
            setCallback(pickerCallback).
            build();
        picker.setVisible(true);
    }

    // A simple callback implementation.
    function pickerCallback(data) {
      if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
        var doc = data[google.picker.Response.DOCUMENTS][0];
        var url = doc[google.picker.Document.URL];
        var id = doc[google.picker.Document.ID];
        var title = doc[google.picker.Document.NAME];

        var visible_element = document.createElement("li");
        $(visible_element).append(
            $('<a>').attr('href', url).attr("target","_blank").append(
                $('<span>').append(title)
            )
        );

        var data_element = document.createElement("li");
        var input = document.createElement('input');
        var list = document.getElementById("videolist");
        input.id = "videolist-" + input_counter;
        input.type = "hidden";
        input.value = JSON.stringify({ 'youtube_id': id });
        input.name = "videolist-" + input_counter;
        data_element.appendChild(input);
        list.appendChild(data_element);
        input_counter++;

        $('#youtubelist').append(visible_element);
      }
    }

    $('.picker').on('click', function(evt){
        newPicker();
    });
    $(".submit").off('click').on('click', function(){
        $("#loading").show();
    });
    $('.choice').on('click', function(evt){
        var $btn = $(this);
        $('.choice').hide();
        if ( $btn.hasClass( "onebyonebtn" ) ) {
            $('.onebyone').show();
        }
        else {
            $('.playlist').show();
        }
    })
</script>
{% endblock %}
